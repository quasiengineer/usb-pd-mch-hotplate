#include "main.h"
#include "thermosensor.h"

static uint16_t adcTable[][2] = {
  { 99, 254 },
  { 100, 253 },
  { 102, 252 },
  { 103, 251 },
  { 105, 250 },
  { 106, 249 },
  { 108, 248 },
  { 110, 247 },
  { 112, 246 },
  { 114, 245 },
  { 116, 244 },
  { 117, 243 },
  { 119, 242 },
  { 121, 241 },
  { 123, 240 },
  { 125, 239 },
  { 128, 238 },
  { 130, 237 },
  { 132, 236 },
  { 134, 235 },
  { 136, 234 },
  { 138, 233 },
  { 141, 232 },
  { 143, 231 },
  { 146, 230 },
  { 148, 229 },
  { 151, 228 },
  { 153, 227 },
  { 156, 226 },
  { 159, 225 },
  { 162, 224 },
  { 164, 223 },
  { 167, 222 },
  { 170, 221 },
  { 173, 220 },
  { 176, 219 },
  { 179, 218 },
  { 182, 217 },
  { 185, 216 },
  { 189, 215 },
  { 192, 214 },
  { 196, 213 },
  { 199, 212 },
  { 203, 211 },
  { 206, 210 },
  { 210, 209 },
  { 214, 208 },
  { 218, 207 },
  { 222, 206 },
  { 226, 205 },
  { 230, 204 },
  { 234, 203 },
  { 239, 202 },
  { 243, 201 },
  { 248, 200 },
  { 252, 199 },
  { 257, 198 },
  { 262, 197 },
  { 267, 196 },
  { 272, 195 },
  { 277, 194 },
  { 283, 193 },
  { 288, 192 },
  { 293, 191 },
  { 299, 190 },
  { 304, 189 },
  { 310, 188 },
  { 316, 187 },
  { 322, 186 },
  { 329, 185 },
  { 335, 184 },
  { 342, 183 },
  { 348, 182 },
  { 355, 181 },
  { 362, 180 },
  { 369, 179 },
  { 376, 178 },
  { 383, 177 },
  { 391, 176 },
  { 399, 175 },
  { 407, 174 },
  { 415, 173 },
  { 423, 172 },
  { 432, 171 },
  { 440, 170 },
  { 448, 169 },
  { 457, 168 },
  { 467, 167 },
  { 476, 166 },
  { 486, 165 },
  { 496, 164 },
  { 506, 163 },
  { 516, 162 },
  { 526, 161 },
  { 537, 160 },
  { 547, 159 },
  { 559, 158 },
  { 570, 157 },
  { 582, 156 },
  { 594, 155 },
  { 606, 154 },
  { 619, 153 },
  { 631, 152 },
  { 644, 151 },
  { 657, 150 },
  { 670, 149 },
  { 683, 148 },
  { 698, 147 },
  { 712, 146 },
  { 727, 145 },
  { 742, 144 },
  { 757, 143 },
  { 773, 142 },
  { 788, 141 },
  { 804, 140 },
  { 820, 139 },
  { 837, 138 },
  { 854, 137 },
  { 872, 136 },
  { 890, 135 },
  { 909, 134 },
  { 927, 133 },
  { 945, 132 },
  { 964, 131 },
  { 983, 130 },
  { 1003, 129 },
  { 1023, 128 },
  { 1044, 127 },
  { 1065, 126 },
  { 1086, 125 },
  { 1109, 124 },
  { 1131, 123 },
  { 1153, 122 },
  { 1175, 121 },
  { 1198, 120 },
  { 1222, 119 },
  { 1246, 118 },
  { 1270, 117 },
  { 1294, 116 },
  { 1319, 115 },
  { 1344, 114 },
  { 1369, 113 },
  { 1396, 112 },
  { 1422, 111 },
  { 1449, 110 },
  { 1478, 109 },
  { 1505, 108 },
  { 1533, 107 },
  { 1560, 106 },
  { 1588, 105 },
  { 1618, 104 },
  { 1647, 103 },
  { 1676, 102 },
  { 1706, 101 },
  { 1735, 100 },
  { 1765, 99 },
  { 1796, 98 },
  { 1827, 97 },
  { 1858, 96 },
  { 1889, 95 },
  { 1920, 94 },
  { 1952, 93 },
  { 1984, 92 },
  { 2017, 91 },
  { 2049, 90 },
  { 2084, 89 },
  { 2116, 88 },
  { 2148, 87 },
  { 2180, 86 },
  { 2213, 85 },
  { 2247, 84 },
  { 2280, 83 },
  { 2313, 82 },
  { 2345, 81 },
  { 2378, 80 },
  { 2412, 79 },
  { 2445, 78 },
  { 2478, 77 },
  { 2511, 76 },
  { 2544, 75 },
  { 2576, 74 },
  { 2609, 73 },
  { 2642, 72 },
  { 2674, 71 },
  { 2706, 70 },
  { 2738, 69 },
  { 2770, 68 },
  { 2801, 67 },
  { 2833, 66 },
  { 2864, 65 },
  { 2894, 64 },
  { 2925, 63 },
  { 2955, 62 },
  { 2985, 61 },
  { 3015, 60 },
  { 3043, 59 },
  { 3072, 58 },
  { 3101, 57 },
  { 3129, 56 },
  { 3156, 55 },
  { 3183, 54 },
  { 3210, 53 },
  { 3236, 52 },
  { 3262, 51 },
  { 3288, 50 },
  { 3313, 49 },
  { 3337, 48 },
  { 3361, 47 },
  { 3385, 46 },
  { 3408, 45 },
  { 3431, 44 },
  { 3453, 43 },
  { 3474, 42 },
  { 3495, 41 },
  { 3516, 40 },
  { 3537, 39 },
  { 3556, 38 },
  { 3575, 37 },
  { 3594, 36 },
  { 3612, 35 },
  { 3631, 34 },
  { 3648, 33 },
  { 3664, 32 },
  { 3680, 31 },
  { 3696, 30 },
  { 3711, 29 },
  { 3726, 28 },
  { 3741, 27 },
  { 3755, 26 },
  { 3769, 25 },
  { 3782, 24 },
  { 3795, 23 },
  { 3807, 22 },
  { 3819, 21 },
  { 3831, 20 },
  { 3842, 19 },
  { 3853, 18 },
  { 3863, 17 },
  { 3873, 16 },
  { 3883, 15 },
  { 3892, 14 },
  { 3901, 13 },
  { 3910, 12 },
  { 3918, 11 },
  { 3926, 10 },
  { 3934, 9 },
  { 3942, 8 },
  { 3949, 7 },
  { 3956, 6 },
  { 3962, 5 },
  { 3969, 4 },
  { 3975, 3 },
  { 3981, 2 },
  { 3986, 1 },
  { 3991, 0 },
};

uint8_t getPlateTemperature() {
  HAL_ADC_PollForConversion(&hadc1, HAL_MAX_DELAY);
  uint32_t adcValue = HAL_ADC_GetValue(&hadc1);

  for (uint8_t i = 0; i < sizeof(adcTable) / sizeof(adcTable[0]); ++i) {
    if (adcValue < adcTable[i][0]) {
      return adcTable[i][1];
    }
  }

  return INCORRECT_TEMP_READING;
}